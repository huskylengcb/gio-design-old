import React, { MouseEvent } from 'react';
import { assign, noop, omit } from 'lodash';
import classnames from 'classnames';
import { isNumber } from '../../utils/helpers';
import { iconfontUrl } from '../../constants';

const styleMap: any = {
  small: { width: '12px', height: '12px' },
  middle: { width: '14px', height: '14px' },
  mediumLarge: { width: '16px', height: '16px' },
  large: { width: '18px', height: '18px' },
  huge: { width: '24px', height: '24px' },
  textBottom: { verticalAlign: 'text-bottom' }
};
const disabledStyle = {
  fill: '#E1DAE6',
  cursor: 'not-allowed'
}
const baseStyle = {
  width: '14px;',
  height: '14px',
  overflow: 'hidden',
  verticalAlign: '-0.15em'
};

export interface IconProps {
  name: string;
  size?: 'huge' | 'large' | 'middle' | 'small' | 'mediumLarge' | number;
  disablePointer?: boolean;
  valign?: string;
  fill?: string;
  onClick?: (e?: MouseEvent<HTMLElement>) => void;
  verticalAlign?: string;
  style?: React.CSSProperties;
  svgStyle?: {
    [name: string]: string
  },
  className?: string,
  svgClassName?: string,
  disabled?: boolean
}

export default class Icon extends React.Component<IconProps, {}> {
  public static defaultProps = {
    name: '',
    size: 'middle',
    disablePointer: false,
    valign: '',
    fill: '',
    onClick: noop,
    disabled: false
  };

  constructor(props: IconProps) {
    super(props);
    if (!document.getElementById('giconJs')) {
      const fontJs = document.createElement('script');
      fontJs.id = 'giconJs';
      fontJs.src = iconfontUrl;
      document.getElementsByTagName('head')[0].appendChild(fontJs);
    }
  }

  public render() {

    const style = assign({}, baseStyle,
      (this.props.disablePointer ? {} : { cursor: 'pointer' }),
      (this.props.fill ? { fill: this.props.fill } : {}),
      styleMap[this.props.size], styleMap[this.props.valign],
      this.props.svgStyle, this.props.disabled ? disabledStyle : {});

    if (isNumber(this.props.size)) {
      style.width = this.props.size + 'px';
      style.height = this.props.size + 'px';
    }

    if (this.props.verticalAlign) {
      style.verticalAlign = this.props.verticalAlign;
    }
    // icon所对应的svg
    const iconSvg = <svg className={classnames('gio-icon', 'gio-' + this.props.name, this.props.svgClassName)} style={style}><use xlinkHref={'#' + this.props.name} /></svg>;
    return (
      <span
        {...omit(this.props, 'svgStyle', 'disablePointer', 'valign')}
        onClick={this.props.disabled ?  noop : this.props.onClick}
        style={this.props.style || {}}
        className={classnames('gio-icon-wrapper', this.props.className, 'x')}
      >
        {iconSvg}
      </span>
    );
  }
}
